@using Microsoft.AspNetCore.Components.Authorization

<AuthorizeView Roles="@CombinedRoles">
    <Authorized>
        @ChildContent
    </Authorized>
    <NotAuthorized>
        @if (NotAuthorizedContent != null)
        {
            @NotAuthorizedContent
        }
        else
        {
            <div class="unauthorized">
                <h3>No autorizado</h3>
                <p>Lo sentimos, no tienes permiso para ver esta página.</p>
                <p>Por favor, contacta al administrador si crees que esto es un error.</p>
            </div>
        }
    </NotAuthorized>
</AuthorizeView>

@code {
    [Parameter] public string Roles { get; set; } = "";
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public RenderFragment? NotAuthorizedContent { get; set; }

    private string CombinedRoles
    {
        get
        {
            var rolesList = new List<string> { AdminRoleCode }; // Siempre incluye Admin

            if (!string.IsNullOrEmpty(Roles))
            {
                var additionalRoles = Roles.Split(',', StringSplitOptions.RemoveEmptyEntries)
                                          .Select(r => r.Trim())
                                          .Where(r => !string.IsNullOrEmpty(r))
                                          .Where(r => !r.Equals(AdminRoleCode, StringComparison.OrdinalIgnoreCase)); // Evita duplicados
                rolesList.AddRange(additionalRoles);
            }

            return string.Join(",", rolesList);
        }
    }
}